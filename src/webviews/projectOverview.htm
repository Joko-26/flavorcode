<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create new Project</title>
    <link rel="stylesheet" href="${styleUri}">
</head>
<body id="body">
    <div class="border-div-full">
        <div id="display" style="display: block;">
            <div class="options">
                <button class="options-button" onclick="switchMode('edit')">Edit</button>
                <button class="options-button" onclick="openSetting()">Settings</button>
            </div>
            <div>
                <h2 id="name"></h2>
                <h4 id="ship"></h4>
                <div class="text-bodies" id="description"></div>
                
                <div class="text-bodies link-row" id="links" >
                    <a id="demo" class="link-button center" style="margin-bottom: 10px; margin-top: 10px;" href="#">Demo</a>
                    <a id="repo" class="link-button center" style="margin-bottom: 10px; margin-top: 10px;" href="#">Repository</a>
                    <a id="readme" class="link-button center" style="margin-bottom: 10px; margin-top: 10px;" href="#">Readme</a>
                </div>
                <div class="text-bodies" id="ai-div">
                    <h3 id="aiHeadline">This project uses AI:</h3>
                    <p id="ai"></p>
                </div>
                <a id="flavortown" class="link-button center" href="#">View this Project on Flavortown</a>
            </div>
        </div>

        

        <div id="edit" style="display: none;">
            <h2>Update current Project</h2>
            <h3>Name:</h3>
            <input id="nameInput" type="text" placeholder="Give your project a name">
            <h3>Description:</h3>
            <textarea id="descriptionInput" placeholder="Share what the project does, who's working on it and what's new."></textarea>
            <h4>Demo Url(optional)</h4>
            <input id="demoInput" type="text" placeholder="https://orosemo.de">
            <h4>Repository Url: (optional)</h4>
            <input id="repoInput" type="text" placeholder="https://github.com/Joko-26/flavorcode">
            <h4>Ai declaration: (optional)</h4>
            <textarea id="aiInput" placeholder="I didn't use ai to generate my code because im cool :D"></textarea>
            <p>Please set the Hackatime project manually on the <a href="https://flavortown.hackclub.com/projects">Flavortown website</a> as the api doesnt support it. :(</p>
            <div class="button-row">
                <button onclick="Update()">Update</button>
                <button class="cancel" onclick="switchMode('display')">Cancel</button>
            </div>
        </div>
    </div>

    <script nonce="${nonce}">
        const vscode = acquireVsCodeApi();
        let projectId = 0

        // set default values to current project info
        function passProjectInfo(projectInfo, id) {
            document.getElementById("name").textContent = projectInfo.name
            document.getElementById("ship").textContent = "Shipping status: " + projectInfo.ship
            document.getElementById("demo").href = projectInfo.demo
            document.getElementById("repo").href = projectInfo.repo
            document.getElementById("flavortown").href = `https://flavortown.hackclub.com/projects/${id}`
            document.getElementById("ai").textContent = projectInfo.ai
            document.getElementById("readme").href = projectInfo.readme

            const desc = document.getElementById("description");
            desc.textContent = "";
            (projectInfo.description || "").split("\n").forEach((line) => {
                desc.innerHTML += `${line}<br>`;
            });

            // remove empty elements
            if (!projectInfo.demo) {
                document.getElementById("links").removeChild(document.getElementById("demo"))
            }
            if (!projectInfo.repo) {
                document.getElementById("links").removeChild(document.getElementById("repo"))
            }
            if (!projectInfo.readme) {
                document.getElementById("links").removeChild(document.getElementById("readme"))
            }
            if (!projectInfo.ai) {
                document.getElementById("ai-div").removeChild(document.getElementById("ai"))
                document.getElementById("ai-div").removeChild(document.getElementById("aiHeadline"))
            }

            document.getElementById("nameInput").value = projectInfo.name
            document.getElementById("descriptionInput").value = projectInfo.description
            document.getElementById("demoInput").value = projectInfo.demo
            document.getElementById("repoInput").value = projectInfo.repo
            document.getElementById("aiInput").value = projectInfo.ai

        }

        function switchMode(mode) {
            if (mode === "display") {
                document.getElementById("display").style = "display: block;"
                document.getElementById("edit").style = "display: none;"
            } else {
                document.getElementById("display").style = "display: none;"
                document.getElementById("edit").style = "display: block;"
            }
        }

        // send inputs to extension
        function Update() {
            const name = document.getElementById("nameInput").value
            const description = document.getElementById("descriptionInput").value
            const demo = document.getElementById("demoInput").value
            const repo = document.getElementById("repoInput").value
            const ai = document.getElementById("aiInput").value
            const createData = { name: name, description: description, demo: demo, repo: repo, ai:ai }
            vscode.postMessage({ command: "update", value: createData })
        }

        function openSetting() {
            vscode.postMessage({command: "open-settings"})
        }

        function refresh() {
            vscode.postMessage({command:"refresh"})
        }

        // listens for messages from the extentsion
        window.addEventListener("message", event => {
            const message = event.data

            switch (message.command) {
                case "project-info":
                    projectId = message.value.projectId
                    passProjectInfo(message.value, message.value.projectId)
                    break
                case "updated-project-info":
                    projectId = message.value.projectId
                    switchMode("display")
                    passProjectInfo(message.value, message.value.projectId)
                    break
            }
        })
    </script>
</body>
</html>